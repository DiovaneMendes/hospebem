
task npmInstall(type: Exec) {
    inputs.file("package.json")

    outputs.dir("node_modules")

    commandLine 'npm', 'install', '--verbose'
}

task cypressRunLocal(type: Exec, dependsOn: ['npmInstall', ':scripts:dbSetup', ':scripts:startFromJar']) {
    description = "Executa os testes funcionais no ambiente local"

    environment 'CYPRESS_baseUrl', 'http://localhost:8080'

    commandLine 'npx', 'cypress', 'run'
}

cypressRunLocal.finalizedBy = [':scripts:stopRunningJar']

task cypressOpen(type: Exec, dependsOn: 'npmInstall') {
    description = "Abre a interface grafica do Cypress"

    environment 'CYPRESS_baseUrl', 'http://localhost:8080'

    commandLine 'npx', 'cypress', 'open'
}